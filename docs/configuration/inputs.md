# KAPy input configuration

*The configuration of inputs in KAPy is set through a tab-separated table, with one row per input variable. The available configuration options are described here. All options are required.*

## Properties

- **`id`** *(string, required)*: A unique id for this dataset. Items must be unique.
- **`datasetID`** *(string, required)*: The ID of the dataset e.g CORDEX, ERA5. Need not be unique. Is used to group related variables from the same data source together further in the analysis (e.g. tas and pr from ERA5). Must not contain a space. Must match pattern: `^[^ ]+$` ([Test](https://regexr.com/?expression=%5E%5B%5E%20%5D%2B%24)).
- **`varID`** *(string, required)*: The ID of the variable contained in this dataset. While there is no enforcement of naming conventions in KAPy, the variable names should anyway be standardised across the entire configuration and across input datasets. For example, both ERA5 and CORDEX provide surface temperature, but with different internal variable names in the input files - to ensure that they can be matched together, they should both be assigned the varName `tas`. Must not contain a space. Must match pattern: `^[^ ]+$` ([Test](https://regexr.com/?expression=%5E%5B%5E%20%5D%2B%24)).
- **`units`** *(['string', 'null'], required)*: The units that the input variable is to be converted to for further processing. KAPy takes an active approach to units, requiring them to be declared and consistent throughout the configuration process. Three scenarios are possible 1. If the input dataset does not have units defined, a units attribute will be created and set to this value - in this case, this argument must be defined and will throw an error if undefined.  2. If the input dataset has units, but this argument is empty, the units will be unchanged. 3. If the input dataset has units that are not the same as the specified argument, the input dataset will be converted to the new units using `xclim.core.units.convert_units_to()` - if this function fails, KAPy will also fail. Checks are also applied to ensure that the units are consistent across variables e.g. that all `tasmax` variables have the same units. For more information, see the xclim documentation regarding unit handling https://xclim.readthedocs.io/en/stable/notebooks/units.html.
- **`gridID`** *(string, required)*: Identifier for the grid that the data set is on. The idnetifier need not be unique, and most commonly will be duplicated across multiple input sources. Must not contain a space. Must match pattern: `^[^ ]+$` ([Test](https://regexr.com/?expression=%5E%5B%5E%20%5D%2B%24)).
- **`path`** *(string, required)*: Path to input files, relative to the working directory. Glob-matching (e.g. `./resources/CORDEX/tas_*`) can be used when the input covers multiple files and/or there are multiple variable types in the same directory.
- **`internalVarName`** *(string, required)*: The internal variable name used within the input file for the variable of interest. For example, in ERA5 files the internal variable name for surface temperature is `t2m` whereas in CORDEX is is `tas`.
- **`fieldSeparator`** *(string)*: Character separating fields in the input file names. Most often an underscore character '_'. Currently limited to a single character. Length must be between 0 and 1 (inclusive).
- **`experimentField`** *(string, required)*: Number of the field in the filename to be used for forming dataseries based on scenarios e.g. for the file `tas_AFR-22_NCC-NorESM1-M_rcp85_r1i1p1_CLMcom-KIT-CCLM5-0-15_v1_day_20360101-20401231.nc`, the fourth field (`rcp85`) contains the emissions scenario code, and this parameter would then be set to 4. If omitted, the experiment code is set to `noExpt`. 1-based indexing is assumed. Must match pattern: `^\d*$` ([Test](https://regexr.com/?expression=%5E%5Cd%2A%24)). Default: `null`.
- **`commonExperimentID`** *(['string', 'null'], required)*: Many climate experiments, such as CMIP, involve splitting time into separate experiments e.g. a `historical` experiment that runs to 2005 and then the `rcp26` and `rcp85` scenario experiments that start from 2006. This field provides the name for the experiment that is common to all others (in this case `historical`) All (other) values of the `experimentField` will be concatenated with this experiment to produce one contiguous *dataseries*. Omission of this parameter will disable this feature, and all experiments will be processed individually. Default: `null`.
- **`ensMemberFields`** *(['string', 'null'], required)*: Comma-separated list of integers representing the fields to join together to make the *ensemble member identifier*. Including the grid descriptor in this configuration is often a good idea, when the same model can be run on two different grids. If not specified, the ensemble member identifier will be set to `noEnsID`. 1-based indexing is assumed. Default: `null`.
- **`importScriptPath`** *(['string', 'null'], required)*: Path to the custom import script. Use this option to enable useage of a custom script to import data before being written to disk as primVars. If empty, then the default import system in KAPy will be used. Default: `null`.
- **`importScriptFunction`** *(['string', 'null'], required)*: Function in the custom import script to be used. Must be supplied if `importScriptPath` is present. Default: `null`.

{
    "title": "KAPy configuration options",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "Configuration schema for KAPy configuration objects. These configurations are usually stored in the `config.yaml` file.",
    "type": "object",
    "required": [
        "configurationTables",
        "outputGrid",
        "arealstats",
        "dirs",
        "ensembles",
        "processing"
    ],
    "additionalProperties": true,
    "properties": {
        "configurationTables": {
            "description": "Paths to configuration tables. See the documentation for each table separately.",
            "required": [
                "inputs",
                "secondaryVars",
                "calibration",
                "indicators",
                "periods",
                "seasons"
            ],
            "additionalProperties": false,
            "properties": {
                "inputs": {
                    "description": "Path to input configuration table, relative to working directory. See [inputs.md](inputs.md) for more detail. Required table",
                    "type": "string"
                },
                "secondaryVars": {
                    "description": "Path to configuration table for secondary variables, relative to working directory. See [derivedVars.md](derivedVars.md) for more details. Optional - if set to '', no secondary variables will be generated",
                    "type": "string"
                },
                "calibration": {
                    "description": "Path to calibration configuration table, relative to working directory. See [calibration.md](calibration.md) for more detail. Optional - if set to '', no calibration will be performed",
                    "type": "string"
                },
                "indicators": {
                    "description": "Path to indicator configuration table, relative to working directory. See [indicators.md](indicators.md) for more detail. Optional - if set to '', no indicators will be generated",
                    "type": "string"
                },
                "periods": {
                    "description": "Path to period configuration table, relative to working directory. See [periods.md](periods.md) for more detail. Required table",
                    "type": "string"
                },
                "seasons": {
                    "description": "Path to season configuration table, relative to working directory. See [seasons.md](seasons.md) for more detail. Required table",
                    "type": "string"
                }
            }
        },
        "dirs": {
            "description": "Directories for storing output and intermediate files. Can be specified as either absolute paths, or relative to the working directory. See the [KAPy concepts](../KAPy_concepts.md) documentation for a more detailed description of these items",
            "type": "object",
            "required": [
                "variables",
                "calibration",
                "indicators",
                "regridded",
                "ensstats",
                "arealstats",
                "plots",
                "tempDir"
            ],
            "additionalProperties": false,
            "properties": {
                "variables": {
                    "description": "Directory for storing variables.",
                    "type": "string"
                },
                "calibration": {
                    "description": "Directory for storing calibrated variables.",
                    "type": "string"
                },
                "indicators": {
                    "description": "Directory for storing indicators.",
                    "type": "string"
                },
                "regridded": {
                    "description": "Directory for storing indicators regridded to a common grid.",
                    "type": "string"
                },
                "ensstats": {
                    "description": "Directory for storing ensemble statistics.",
                    "type": "string"
                },
                "arealstats": {
                    "description": "Directory for storing statistics calculated over areas.",
                    "type": "string"
                },
                "plots": {
                    "description": "Directory for storing output plots.",
                    "type": "string"
                },
                "tempDir": {
                    "description": "Temporary directory to be used for scratch files",
                    "type": "string"
                }
            }
        },
        "arealstats": {
            "required": [
                "useAreaWeighting",
                "shapefile",
                "idColumn"
            ],
            "additionalProperties": false,
            "type": "object",
            "properties": {
                "useAreaWeighting": {
                    "description": "Use area-weighting when calculating averages over a polygon or area. Nearly all climate data is presented on grids where the area of the pixels is not constant, but changes in space - for example, on a regular lat-lon grid, the pixels get smaller towards the poles. When this option is configured, the CDO `gridarea` operator is used to calculate the area of each cell, and weightings applied to the calculation of area statistics accordingly. Requires that CDO can calculate the cell area - otherwise, it is recommended to disable this option manually.",
                    "type": "boolean"
                },
                "shapefile": {
                    "description": "Path to shapefile to be used for defining areas. When the path is undefined, averages are calculated across the entire domain. The path should point to the .shp file.",
                    "type": ["string","null"]
                },
                "idColumn": {
                    "description": "Name of the column in the above shapefile to be used as a unique identifier code for the area.",
                    "type": ["string","null"]
                }
            }
        },
        "cutouts": {
            "description": "Configures spatial-subsetting (cutting-out) of the input data.",
            "oneOf": [
                {
                    "type": "object",
                    "required": [
                        "method"
                    ],
                    "additionalProperties": false,
                    "description": "**none**. Omit the cutout step. All available data in the input files is processed.",
                    "properties": {
                        "method": {
                            "type": "string",
                            "enum": [
                                "none"
                            ]
                        }
                    }
                },
                {
                    "type": "object",
                    "required": [
                        "method",
                        "xmin",
                        "xmax",
                        "ymin",
                        "ymax"
                    ],
                    "additionalProperties": false,
                    "description": "**lonlatbox**. Use the `sellonlatbox`operator from cdo to do the subsetting. Details of this operator can be found in the CDO documentation.",
                    "properties": {
                        "method": {
                            "type": "string",
                            "enum": [
                                "lonlatbox"
                            ]
                        },
                        "xmin": {
                            "description": "Western boundary of cutout box",
                            "type": "number"
                        },
                        "xmax": {
                            "description": "Eastern boundary of cutout box",
                            "type": "number"
                        },
                        "ymin": {
                            "description": "Southern boundary of cutout box",
                            "type": "number"
                        },
                        "ymax": {
                            "description": "Northern boundary of cutout box",
                            "type": "number"
                        }
                    }
                }
            ]
        },
        "ensembles": {
            "description": "Specify the percentiles [0-100] calculated from the ensemble. We allow three values, corresponding to the upper and lower confidence limits, and the central value.",
            "type": "object",
            "required": [
                "upperPercentile",
                "centralPercentile",
                "lowerPercentile"
            ],
            "additionalProperties": false,
            "properties": {
                "upperPercentile": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "exclusiveMaximum": 100
                },
                "centralPercentile": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "exclusiveMaximum": 100
                },
                "lowerPercentile": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "exclusiveMaximum": 100
                }
            }
        },
        "outputGrid": {
            "description": "Defines the common output grid onto which KAPy interpolates all indicators before calculating ensemble statistics. Can be disabled by setting `templateType` to `none`. ",
            "type": "object",
            "required": [
                "templateType",
                "gridName",
                "method",
                "path"
            ],
            "additionalProperties": false,
            "properties": {
                "templateType": {
                    "type": "string",
                    "description": "Type of template to use to specify the output grid. Selecting `none` will disable regridding. Selecting `file` will use an existing NetCDF file as the template. `cdo` uses a CDO grid descriptor file as the template.",
                    "enum": [
                        "none",
                        "cdo",
                        "file"
                    ]
                },
                "gridName": {
                    "description": "String giving the name of the grid to be used in regridding filenames.",
                    "type": "string"
                },
                "method": {
                    "description": "Method used by the xESMF Regridder function to do the regridding. See documentaiton for xESMF for details.",
                    "type": "string",
                    "enum": [
                        "bilinear",
                        "conservative",
                        "conservative_normed",
                        "patch",
                        "nearest_s2d",
                        "nearest_d2s"
                    ]
                },
                "path": {
                    "description": "Path to the file to be used as a template, in the case of a `file` templateType, or the cdo grid descriptor, in the case of `cdo` templateType.",
                    "type": "string"
                }
            }
        }, 
        "processing": {
            "required": [
                "picklePrimaryVariables"
            ],
            "additionalProperties": false,
            "type": "object",
            "properties": {
                "picklePrimaryVariables": {
                    "description": "Should the the primary variables be stored as 'pickled' xarray objects (`True`) or written out to disk as NetCDF files (`False`).",
                    "type": "boolean"
                }
            }
        }
    }
}